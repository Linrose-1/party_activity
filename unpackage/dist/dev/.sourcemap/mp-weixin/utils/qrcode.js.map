{"version":3,"file":"qrcode.js","sources":["utils/qrcode.js"],"sourcesContent":["import request from '@/utils/request.js';\r\n\r\n/**\r\n * é€šç”¨ç”Ÿæˆå°ç¨‹åºç æ–¹æ³•\r\n * @param {String} path - é¡µé¢è·¯å¾„ï¼Œå¦‚ 'pages/home/home'\r\n * @param {Object} customParams - è‡ªå®šä¹‰å‚æ•°å¯¹è±¡ï¼Œå¦‚ { id: 123 }\r\n * @returns {Promise<String>} - è¿”å› Base64 å›¾ç‰‡æ•°æ®\r\n */\r\nexport const generatePromotionQrCode = async (path, customParams = {}) => {\r\n\tconst userId = uni.getStorageSync('userId');\r\n\tconst userInfoStr = uni.getStorageSync('userInfo');\r\n\tlet inviteCode = '';\r\n\r\n\tif (userInfoStr) {\r\n\t\ttry {\r\n\t\t\tconst user = JSON.parse(userInfoStr);\r\n\t\t\tinviteCode = user.shardCode || '';\r\n\t\t} catch (e) {}\r\n\t}\r\n\r\n\t// 1. ç»„è£… Scene å‚æ•° (ä¸¥æ ¼æ§åˆ¶32ä½ä»¥å†…)\r\n\t// c: é‚€è¯·ç , s: åˆ†äº«äºº, fs: åˆ†äº«æ ‡è®°\r\n\tconst params = [];\r\n\tif (inviteCode) params.push(`c=${inviteCode}`);\r\n\tif (userId) params.push(`s=${userId}`);\r\n\r\n\t// åˆå¹¶é¢å¤–ä¼ å…¥çš„å‚æ•° (å¦‚ i=123)\r\n\tObject.keys(customParams).forEach(key => {\r\n\t\tparams.push(`${key}=${customParams[key]}`);\r\n\t});\r\n\r\n\tparams.push('fs=1'); // å›ºå®šåˆ†äº«æ ‡è®°\r\n\tconst scene = params.join('&');\r\n\r\n\tconsole.log(`ğŸš€ [ç”ŸæˆäºŒç»´ç ] è·¯å¾„: ${path}, Scene: ${scene}`);\r\n\r\n\t// 2. è°ƒç”¨æ¥å£\r\n\tconst {\r\n\t\tdata,\r\n\t\terror\r\n\t} = await request('/app-api/member/social-user/wxa-qrcode', {\r\n\t\tmethod: 'POST',\r\n\t\tdata: {\r\n\t\t\tscene: scene,\r\n\t\t\tpath: path,\r\n\t\t\twidth: 430,\r\n\t\t\tautoColor: true,\r\n\t\t\tcheckPath: true,\r\n\t\t\thyaline: true\r\n\t\t}\r\n\t});\r\n\r\n\tif (error) {\r\n\t\tconsole.error('ç”ŸæˆäºŒç»´ç å¤±è´¥:', error);\r\n\t\treturn '';\r\n\t}\r\n\r\n\t// 3. è¿”å›å¤„ç†å¥½çš„ Base64\r\n\treturn data.startsWith('data:image') ? data : `data:image/png;base64,${data}`;\r\n};"],"names":["uni","request"],"mappings":";;;AAQY,MAAC,0BAA0B,OAAO,MAAM,eAAe,OAAO;AACzE,QAAM,SAASA,cAAAA,MAAI,eAAe,QAAQ;AAC1C,QAAM,cAAcA,cAAAA,MAAI,eAAe,UAAU;AACjD,MAAI,aAAa;AAEjB,MAAI,aAAa;AAChB,QAAI;AACH,YAAM,OAAO,KAAK,MAAM,WAAW;AACnC,mBAAa,KAAK,aAAa;AAAA,IAClC,SAAW,GAAG;AAAA,IAAE;AAAA,EACd;AAID,QAAM,SAAS,CAAA;AACf,MAAI;AAAY,WAAO,KAAK,KAAK,UAAU,EAAE;AAC7C,MAAI;AAAQ,WAAO,KAAK,KAAK,MAAM,EAAE;AAGrC,SAAO,KAAK,YAAY,EAAE,QAAQ,SAAO;AACxC,WAAO,KAAK,GAAG,GAAG,IAAI,aAAa,GAAG,CAAC,EAAE;AAAA,EAC3C,CAAE;AAED,SAAO,KAAK,MAAM;AAClB,QAAM,QAAQ,OAAO,KAAK,GAAG;AAE7BA,sBAAA,MAAA,OAAA,yBAAY,kBAAkB,IAAI,YAAY,KAAK,EAAE;AAGrD,QAAM;AAAA,IACL;AAAA,IACA;AAAA,EACF,IAAK,MAAMC,cAAO,QAAC,0CAA0C;AAAA,IAC3D,QAAQ;AAAA,IACR,MAAM;AAAA,MACL;AAAA,MACA;AAAA,MACA,OAAO;AAAA,MACP,WAAW;AAAA,MACX,WAAW;AAAA,MACX,SAAS;AAAA,IACT;AAAA,EACH,CAAE;AAED,MAAI,OAAO;AACVD,gEAAc,YAAY,KAAK;AAC/B,WAAO;AAAA,EACP;AAGD,SAAO,KAAK,WAAW,YAAY,IAAI,OAAO,yBAAyB,IAAI;AAC5E;;"}