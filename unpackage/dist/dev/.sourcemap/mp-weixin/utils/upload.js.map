{"version":3,"file":"upload.js","sources":["utils/upload.js"],"sourcesContent":["// 1. 定义项目的基础URL，与 request.js 保持一致或集中管理\nconst baseURL = 'http://8.163.18.207:48080';\n\n/**\n * 封装 uni.uploadFile 用于文件上传\n * @param {string} filePath - 必填，文件的本地临时路径\n * @param {object} [options={}] - 可选，其他配置项\n * @param {string} [options.directory=''] - 上传到服务器的目录\n * @param {string} [options.name='file'] - 后端接收文件时使用的字段名，默认为 'file'\n * @returns {Promise<{data: string|null, error: string|null}>} - 返回一个包含 { data, error } 的对象\n */\nconst uploadFile = async (filePath, options = {}) => {\n\t// ------------------- 参数处理 -------------------\n\tif (!filePath) {\n\t\tconsole.error('uploadFile Error: filePath is required.');\n\t\treturn { data: null, error: '未提供文件路径' };\n\t}\n\t// 设置默认值\n\tconst { directory = '', name = 'file' } = options;\n\n\t// ------------------- 获取认证信息 -------------------\n\tconst token = uni.getStorageSync('token');\n\n\t// ------------------- 执行上传 -------------------\n\ttry {\n\t\tconst res = await uni.uploadFile({\n\t\t\turl: baseURL + '/app-api/infra/file/upload', // 完整的上传接口地址\n\t\t\tfilePath: filePath,\n\t\t\tname: name, // 使用可配置的字段名\n\t\t\theader: {\n\t\t\t\t'Authorization': token || '', // 携带认证 Token\n\t\t\t},\n\t\t\tformData: {\n\t\t\t\t// 携带额外的表单数据\n\t\t\t\t'directory': directory\n\t\t\t}\n\t\t});\n\n\t\t// ------------------- 响应处理 -------------------\n\t\tif (res.statusCode === 200) {\n\t\t\t// uni.uploadFile 返回的 res.data 是 JSON 字符串，需要手动解析\n\t\t\tconst responseData = JSON.parse(res.data);\n\n\t\t\tif (responseData.code === 0) {\n\t\t\t\t// 上传成功，返回 URL\n\t\t\t\treturn { data: responseData.data, error: null };\n\t\t\t} else {\n\t\t\t\t// 后端业务逻辑错误\n\t\t\t\treturn { data: null, error: responseData.msg || '上传失败' };\n\t\t\t}\n\t\t} else {\n\t\t\t// HTTP 状态码错误\n\t\t\treturn { data: null, error: `服务器错误: ${res.statusCode}` };\n\t\t}\n\t} catch (err) {\n\t\t// 网络或其他异常\n\t\treturn { data: null, error: err.message || '网络错误' };\n\t}\n};\n\n// 将核心函数导出，以便其他文件可以导入使用\nexport default uploadFile;"],"names":["uni"],"mappings":";;AACA,MAAM,UAAU;AAUX,MAAC,aAAa,OAAO,UAAU,UAAU,OAAO;AAEpD,MAAI,CAAC,UAAU;AACdA,kBAAAA,8CAAc,yCAAyC;AACvD,WAAO,EAAE,MAAM,MAAM,OAAO,UAAS;AAAA,EACrC;AAED,QAAM,EAAE,YAAY,IAAI,OAAO,OAAM,IAAK;AAG1C,QAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AAGxC,MAAI;AACH,UAAM,MAAM,MAAMA,cAAG,MAAC,WAAW;AAAA,MAChC,KAAK,UAAU;AAAA;AAAA,MACf;AAAA,MACA;AAAA;AAAA,MACA,QAAQ;AAAA,QACP,iBAAiB,SAAS;AAAA;AAAA,MAC1B;AAAA,MACD,UAAU;AAAA;AAAA,QAET,aAAa;AAAA,MACb;AAAA,IACJ,CAAG;AAGD,QAAI,IAAI,eAAe,KAAK;AAE3B,YAAM,eAAe,KAAK,MAAM,IAAI,IAAI;AAExC,UAAI,aAAa,SAAS,GAAG;AAE5B,eAAO,EAAE,MAAM,aAAa,MAAM,OAAO,KAAI;AAAA,MACjD,OAAU;AAEN,eAAO,EAAE,MAAM,MAAM,OAAO,aAAa,OAAO;MAChD;AAAA,IACJ,OAAS;AAEN,aAAO,EAAE,MAAM,MAAM,OAAO,UAAU,IAAI,UAAU;IACpD;AAAA,EACD,SAAQ,KAAK;AAEb,WAAO,EAAE,MAAM,MAAM,OAAO,IAAI,WAAW;EAC3C;AACF;;"}