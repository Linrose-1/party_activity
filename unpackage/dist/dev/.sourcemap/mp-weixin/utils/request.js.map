{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["// const baseURL = 'https://jyj.gofor.club';\r\nconst baseURL = 'https://test-api.gofor.club/local';\r\n// const baseURL = 'https://chuxia5207.top';\r\n// const baseURL = 'http://8.163.18.207:48080';s\r\nconst timeout = 10000;\r\n\r\nconst request = async (url, options = {}) => {\r\n\t// 1. 初始化 Header，默认加上 JSON 类型\r\n\tconst headers = {\r\n\t\t'Content-Type': 'application/json',\r\n\t\t...options.header\r\n\t};\r\n\r\n\t// 2. 处理 Token\r\n\tconst token = uni.getStorageSync('token');\r\n\t// 只有当 token 有效且非空字符串时，才添加 Authorization\r\n\tif (token && typeof token === 'string' && token.trim() !== '') {\r\n\t\theaders['Authorization'] = token;\r\n\t}\r\n\r\n\tconst config = {\r\n\t\turl: baseURL + url,\r\n\t\tmethod: options.method || 'GET',\r\n\t\tdata: options.data || {},\r\n\t\theader: headers, // 使用处理好的 headers\r\n\t\ttimeout: options.timeout || timeout,\r\n\t};\r\n\r\n\t// --- 调试日志 --\r\n\t// console.log(`[Request] ${config.method} ${config.url}`);\r\n\t// console.log(`[Headers]`, JSON.stringify(config.header));\r\n\t// console.log(`[Data]`, JSON.stringify(config.data));\r\n\t// ---------------------------------\r\n\r\n\ttry {\r\n\t\tconst res = await uni.request(config);\r\n\r\n\t\t// 打印后端返回的原始数据，看看系统异常到底长啥样\r\n\t\tconsole.log(`[Response]`, res.statusCode, res.data);\r\n\r\n\t\tif (res.statusCode === 200) {\r\n\t\t\tif (res.data.code === 0) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdata: res.data.data,\r\n\t\t\t\t\terror: null\r\n\t\t\t\t};\r\n\t\t\t} else if (res.data.code === 401) {\r\n\t\t\t\t// 401 逻辑：只清除 Token，不强制跳转\r\n\t\t\t\t// 这样首页 onShow 里的 if (!token) 逻辑就会生效，从而触发静默登录\r\n\t\t\t\tconsole.warn('Token 失效 (401)，清除本地缓存');\r\n\t\t\t\tuni.removeStorageSync('token');\r\n\t\t\t\tuni.removeStorageSync('userId');\r\n\t\t\t\t// 注意：不要清除 userInfo，以免影响静默登录前的展示\r\n\r\n\t\t\t\t// 返回错误，让业务层知道失败了\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t\terror: '账号未登录'\r\n\t\t\t\t};\r\n\t\t\t} else if (res.data.code === 453) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t\terror: res.data\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t\terror: res.data.msg || '请求失败'\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\tdata: null,\r\n\t\t\t\terror: 'HTTP状态码: ' + res.statusCode\r\n\t\t\t};\r\n\t\t}\r\n\t} catch (err) {\r\n\t\tconsole.error('[Network Error]', err);\r\n\t\treturn {\r\n\t\t\tdata: null,\r\n\t\t\terror: err.message || '网络错误'\r\n\t\t};\r\n\t}\r\n};\r\n\r\nexport default request;"],"names":["uni"],"mappings":";;AACA,MAAM,UAAU;AAGhB,MAAM,UAAU;AAEX,MAAC,UAAU,OAAO,KAAK,UAAU,OAAO;AAE5C,QAAM,UAAU;AAAA,IACf,gBAAgB;AAAA,IAChB,GAAG,QAAQ;AAAA,EACb;AAGC,QAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AAExC,MAAI,SAAS,OAAO,UAAU,YAAY,MAAM,KAAM,MAAK,IAAI;AAC9D,YAAQ,eAAe,IAAI;AAAA,EAC3B;AAED,QAAM,SAAS;AAAA,IACd,KAAK,UAAU;AAAA,IACf,QAAQ,QAAQ,UAAU;AAAA,IAC1B,MAAM,QAAQ,QAAQ,CAAE;AAAA,IACxB,QAAQ;AAAA;AAAA,IACR,SAAS,QAAQ,WAAW;AAAA,EAC9B;AAQC,MAAI;AACH,UAAM,MAAM,MAAMA,cAAAA,MAAI,QAAQ,MAAM;AAGpCA,kBAAAA,MAAY,MAAA,OAAA,0BAAA,cAAc,IAAI,YAAY,IAAI,IAAI;AAElD,QAAI,IAAI,eAAe,KAAK;AAC3B,UAAI,IAAI,KAAK,SAAS,GAAG;AACxB,eAAO;AAAA,UACN,MAAM,IAAI,KAAK;AAAA,UACf,OAAO;AAAA,QACZ;AAAA,MACI,WAAU,IAAI,KAAK,SAAS,KAAK;AAGjCA,sBAAAA,MAAA,MAAA,QAAA,0BAAa,uBAAuB;AACpCA,4BAAI,kBAAkB,OAAO;AAC7BA,4BAAI,kBAAkB,QAAQ;AAI9B,eAAO;AAAA,UACN,MAAM;AAAA,UACN,OAAO;AAAA,QACZ;AAAA,MACI,WAAU,IAAI,KAAK,SAAS,KAAK;AACjC,eAAO;AAAA,UACN,MAAM;AAAA,UACN,OAAO,IAAI;AAAA,QAChB;AAAA,MACA,OAAU;AACN,eAAO;AAAA,UACN,MAAM;AAAA,UACN,OAAO,IAAI,KAAK,OAAO;AAAA,QAC5B;AAAA,MACI;AAAA,IACJ,OAAS;AACN,aAAO;AAAA,QACN,MAAM;AAAA,QACN,OAAO,cAAc,IAAI;AAAA,MAC7B;AAAA,IACG;AAAA,EACD,SAAQ,KAAK;AACbA,kBAAc,MAAA,MAAA,SAAA,0BAAA,mBAAmB,GAAG;AACpC,WAAO;AAAA,MACN,MAAM;AAAA,MACN,OAAO,IAAI,WAAW;AAAA,IACzB;AAAA,EACE;AACF;;"}