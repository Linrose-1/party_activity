{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["// import {\r\n// \tref\r\n// } from 'vue';\r\n\r\n// // 请求的基本配置\r\n// const baseURL = 'https://jyj.gofor.club';\r\n// // const baseURL = 'http://haiyan.nat300.top';\r\n// // const baseURL = 'https://chuxia5207.top';\r\n// // const baseURL = 'http://8.163.18.207:48080';\r\n// const timeout = 10000; // 请求超时\r\n\r\n// // 封装请求方法\r\n// const request = async (url, options = {}) => {\r\n// \tconst config = {\r\n// \t\turl: baseURL + url,\r\n// \t\tmethod: options.method || 'GET', // 默认为GET请求\r\n// \t\tdata: options.data || {}, // 请求的数据\r\n// \t\theader: options.header || {}, // 请求头\r\n// \t\ttimeout: options.timeout || timeout, // 请求超时\r\n// \t};\r\n\r\n// \tconfig.header['Content-Type'] = 'application/json';\r\n\r\n// \t// 获取 access_token 并加入请求头\r\n// \tconst token = uni.getStorageSync('token');\r\n// \t// const token = '0cdbffcfe50141019187077afdf4fb6f';\r\n// \tif (token) {\r\n// \t\t// config.header['Authorization'] = `Bearer ${token}`;\r\n// \t\tconfig.header['Authorization'] = token;\r\n// \t}\r\n\r\n// \tconsole.log('================ 请求大起底 ================');\r\n// \tconsole.log('1. 请求 URL:', config.url);\r\n// \tconsole.log('2. 本地 Token 值:', token, '类型:', typeof token);\r\n// \tconsole.log('3. 最终 Headers:', JSON.stringify(config.header));\r\n// \tconsole.log('4. 发送 Body 数据:', JSON.stringify(config.data));\r\n// \tconsole.log('==========================================');\r\n\r\n// \ttry {\r\n// \t\tconst res = await uni.request(config);\r\n\r\n// \t\tif (res.statusCode === 200) {\r\n// \t\t\t// 判断返回的 code 字段是否为 0 (成功)\r\n// \t\t\tif (res.data.code === 0) {\r\n// \t\t\t\treturn {\r\n// \t\t\t\t\tdata: res.data.data,\r\n// \t\t\t\t\terror: null\r\n// \t\t\t\t};\r\n// \t\t\t} else {\r\n// \t\t\t\t// 【【【核心修改点在这里】】】\r\n// \t\t\t\t// 检查是否是需要特殊处理的 453 错误码\r\n// \t\t\t\tif (res.data.code === 453) {\r\n// \t\t\t\t\t// 如果是 453，返回整个 res.data 对象\r\n// \t\t\t\t\t// 这样业务代码就能拿到 code 和 msg\r\n// \t\t\t\t\treturn {\r\n// \t\t\t\t\t\tdata: null,\r\n// \t\t\t\t\t\terror: res.data // 返回 { code: 453, msg: '...' }\r\n// \t\t\t\t\t};\r\n// \t\t\t\t} else {\r\n// \t\t\t\t\t// 对于其他所有业务错误，保持原有逻辑不变\r\n// \t\t\t\t\treturn {\r\n// \t\t\t\t\t\tdata: null,\r\n// \t\t\t\t\t\terror: res.data.msg || '请求失败' // 只返回错误消息字符串\r\n// \t\t\t\t\t};\r\n// \t\t\t\t}\r\n// \t\t\t}\r\n// \t\t} else {\r\n// \t\t\treturn {\r\n// \t\t\t\tdata: null,\r\n// \t\t\t\terror: '请求失败，状态码: ' + res.statusCode\r\n// \t\t\t};\r\n// \t\t}\r\n// \t} catch (err) {\r\n// \t\treturn {\r\n// \t\t\tdata: null,\r\n// \t\t\terror: err.message || '网络错误'\r\n// \t\t};\r\n// \t}\r\n// };\r\n\r\n// // 导出封装的请求方法\r\n// export default request;\r\n\r\n// src/utils/request.js\r\n\r\nconst baseURL = 'https://jyj.gofor.club';\r\n// const baseURL = 'http://haiyan.nat300.top';\r\n// const baseURL = 'https://chuxia5207.top';\r\n// const baseURL = 'http://8.163.18.207:48080';\r\nconst timeout = 10000;\r\n\r\nconst request = async (url, options = {}) => {\r\n\t// 1. 初始化 Header，默认加上 JSON 类型\r\n\tconst headers = {\r\n\t\t'Content-Type': 'application/json',\r\n\t\t...options.header\r\n\t};\r\n\r\n\t// 2. 处理 Token\r\n\tconst token = uni.getStorageSync('token');\r\n\t// 只有当 token 有效且非空字符串时，才添加 Authorization\r\n\tif (token && typeof token === 'string' && token.trim() !== '') {\r\n\t\theaders['Authorization'] = token;\r\n\t}\r\n\r\n\tconst config = {\r\n\t\turl: baseURL + url,\r\n\t\tmethod: options.method || 'GET',\r\n\t\tdata: options.data || {},\r\n\t\theader: headers, // 使用处理好的 headers\r\n\t\ttimeout: options.timeout || timeout,\r\n\t};\r\n\r\n\t// --- 调试日志 --\r\n\t// console.log(`[Request] ${config.method} ${config.url}`);\r\n\t// console.log(`[Headers]`, JSON.stringify(config.header));\r\n\t// console.log(`[Data]`, JSON.stringify(config.data));\r\n\t// ---------------------------------\r\n\r\n\ttry {\r\n\t\tconst res = await uni.request(config);\r\n\r\n\t\t// 打印后端返回的原始数据，看看系统异常到底长啥样\r\n\t\tconsole.log(`[Response]`, res.statusCode, res.data);\r\n\r\n\t\tif (res.statusCode === 200) {\r\n\t\t\tif (res.data.code === 0) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdata: res.data.data,\r\n\t\t\t\t\terror: null\r\n\t\t\t\t};\r\n\t\t\t} else if (res.data.code === 453) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t\terror: res.data\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t\terror: res.data.msg || '请求失败'\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\tdata: null,\r\n\t\t\t\terror: 'HTTP状态码: ' + res.statusCode\r\n\t\t\t};\r\n\t\t}\r\n\t} catch (err) {\r\n\t\tconsole.error('[Network Error]', err);\r\n\t\treturn {\r\n\t\t\tdata: null,\r\n\t\t\terror: err.message || '网络错误'\r\n\t\t};\r\n\t}\r\n};\r\n\r\nexport default request;"],"names":["uni"],"mappings":";;AAqFA,MAAM,UAAU;AAIhB,MAAM,UAAU;AAEX,MAAC,UAAU,OAAO,KAAK,UAAU,OAAO;AAE5C,QAAM,UAAU;AAAA,IACf,gBAAgB;AAAA,IAChB,GAAG,QAAQ;AAAA,EACb;AAGC,QAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AAExC,MAAI,SAAS,OAAO,UAAU,YAAY,MAAM,KAAM,MAAK,IAAI;AAC9D,YAAQ,eAAe,IAAI;AAAA,EAC3B;AAED,QAAM,SAAS;AAAA,IACd,KAAK,UAAU;AAAA,IACf,QAAQ,QAAQ,UAAU;AAAA,IAC1B,MAAM,QAAQ,QAAQ,CAAE;AAAA,IACxB,QAAQ;AAAA;AAAA,IACR,SAAS,QAAQ,WAAW;AAAA,EAC9B;AAQC,MAAI;AACH,UAAM,MAAM,MAAMA,cAAAA,MAAI,QAAQ,MAAM;AAGpCA,kBAAAA,MAAY,MAAA,OAAA,2BAAA,cAAc,IAAI,YAAY,IAAI,IAAI;AAElD,QAAI,IAAI,eAAe,KAAK;AAC3B,UAAI,IAAI,KAAK,SAAS,GAAG;AACxB,eAAO;AAAA,UACN,MAAM,IAAI,KAAK;AAAA,UACf,OAAO;AAAA,QACZ;AAAA,MACI,WAAU,IAAI,KAAK,SAAS,KAAK;AACjC,eAAO;AAAA,UACN,MAAM;AAAA,UACN,OAAO,IAAI;AAAA,QAChB;AAAA,MACA,OAAU;AACN,eAAO;AAAA,UACN,MAAM;AAAA,UACN,OAAO,IAAI,KAAK,OAAO;AAAA,QAC5B;AAAA,MACI;AAAA,IACJ,OAAS;AACN,aAAO;AAAA,QACN,MAAM;AAAA,QACN,OAAO,cAAc,IAAI;AAAA,MAC7B;AAAA,IACG;AAAA,EACD,SAAQ,KAAK;AACbA,kBAAc,MAAA,MAAA,SAAA,2BAAA,mBAAmB,GAAG;AACpC,WAAO;AAAA,MACN,MAAM;AAAA,MACN,OAAO,IAAI,WAAW;AAAA,IACzB;AAAA,EACE;AACF;;"}