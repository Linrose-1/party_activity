{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["import {\r\n\tref\r\n} from 'vue';\r\n\r\n// 请求的基本配置\r\n// const baseURL = 'https://chuxia5207.top';\r\nconst baseURL = 'https://jyj.gofor.club';\r\n// const baseURL = 'http://8.163.18.207:48080';\r\nconst timeout = 10000; // 请求超时\r\n\r\n// 封装请求方法\r\nconst request = async (url, options = {}) => {\r\n\tconst config = {\r\n\t\turl: baseURL + url,\r\n\t\tmethod: options.method || 'GET', // 默认为GET请求\r\n\t\tdata: options.data || {}, // 请求的数据\r\n\t\theader: options.header || {}, // 请求头\r\n\t\ttimeout: options.timeout || timeout, // 请求超时\r\n\t};\r\n\r\n\t// 获取 access_token 并加入请求头\r\n\tconst token = uni.getStorageSync('token');\r\n\t// const token = '0cdbffcfe50141019187077afdf4fb6f';\r\n\tif (token) {\r\n\t\t// config.header['Authorization'] = `Bearer ${token}`;\r\n\t\tconfig.header['Authorization'] = token;\r\n\t}\r\n\r\n\ttry {\r\n\t\tconst res = await uni.request(config);\r\n\r\n\t\tif (res.statusCode === 200) {\r\n\t\t\t// 判断返回的 code 字段是否为 0 (成功)\r\n\t\t\tif (res.data.code === 0) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdata: res.data.data,\r\n\t\t\t\t\terror: null\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\t// 【【【核心修改点在这里】】】\r\n\t\t\t\t// 检查是否是需要特殊处理的 453 错误码\r\n\t\t\t\tif (res.data.code === 453) {\r\n\t\t\t\t\t// 如果是 453，返回整个 res.data 对象\r\n\t\t\t\t\t// 这样业务代码就能拿到 code 和 msg\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tdata: null,\r\n\t\t\t\t\t\terror: res.data // 返回 { code: 453, msg: '...' }\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 对于其他所有业务错误，保持原有逻辑不变\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tdata: null,\r\n\t\t\t\t\t\terror: res.data.msg || '请求失败' // 只返回错误消息字符串\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\tdata: null,\r\n\t\t\t\terror: '请求失败，状态码: ' + res.statusCode\r\n\t\t\t};\r\n\t\t}\r\n\t} catch (err) {\r\n\t\treturn {\r\n\t\t\tdata: null,\r\n\t\t\terror: err.message || '网络错误'\r\n\t\t};\r\n\t}\r\n};\r\n\r\n// 导出封装的请求方法\r\nexport default request;"],"names":["uni"],"mappings":";;AAMA,MAAM,UAAU;AAEhB,MAAM,UAAU;AAGX,MAAC,UAAU,OAAO,KAAK,UAAU,OAAO;AAC5C,QAAM,SAAS;AAAA,IACd,KAAK,UAAU;AAAA,IACf,QAAQ,QAAQ,UAAU;AAAA;AAAA,IAC1B,MAAM,QAAQ,QAAQ,CAAE;AAAA;AAAA,IACxB,QAAQ,QAAQ,UAAU,CAAE;AAAA;AAAA,IAC5B,SAAS,QAAQ,WAAW;AAAA;AAAA,EAC9B;AAGC,QAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AAExC,MAAI,OAAO;AAEV,WAAO,OAAO,eAAe,IAAI;AAAA,EACjC;AAED,MAAI;AACH,UAAM,MAAM,MAAMA,cAAAA,MAAI,QAAQ,MAAM;AAEpC,QAAI,IAAI,eAAe,KAAK;AAE3B,UAAI,IAAI,KAAK,SAAS,GAAG;AACxB,eAAO;AAAA,UACN,MAAM,IAAI,KAAK;AAAA,UACf,OAAO;AAAA,QACZ;AAAA,MACA,OAAU;AAGN,YAAI,IAAI,KAAK,SAAS,KAAK;AAG1B,iBAAO;AAAA,YACN,MAAM;AAAA,YACN,OAAO,IAAI;AAAA;AAAA,UACjB;AAAA,QACA,OAAW;AAEN,iBAAO;AAAA,YACN,MAAM;AAAA,YACN,OAAO,IAAI,KAAK,OAAO;AAAA;AAAA,UAC7B;AAAA,QACK;AAAA,MACD;AAAA,IACJ,OAAS;AACN,aAAO;AAAA,QACN,MAAM;AAAA,QACN,OAAO,eAAe,IAAI;AAAA,MAC9B;AAAA,IACG;AAAA,EACD,SAAQ,KAAK;AACb,WAAO;AAAA,MACN,MAAM;AAAA,MACN,OAAO,IAAI,WAAW;AAAA,IACzB;AAAA,EACE;AACF;;"}