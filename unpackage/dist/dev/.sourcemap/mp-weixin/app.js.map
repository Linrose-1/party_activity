{"version":3,"file":"app.js","sources":["App.vue"],"sourcesContent":["<script>\r\n\timport request from '@/utils/request.js';\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tlocationTimer: null\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLaunch: function(options) {\r\n\t\t\tconsole.warn('当前组件仅支持 uni_modules 目录结构 ，请升级 HBuilderX 到 3.1.0 版本以上！')\r\n\t\t\tconsole.log('App Launch')\r\n\r\n\t\t\tif (options && options.query && options.query.inviteCode) {\r\n\t\t\t\tconst inviteCode = options.query.inviteCode;\r\n\t\t\t\tconsole.log('✅ [App.vue] 全局捕获到启动参数中的邀请码:', inviteCode);\r\n\r\n\t\t\t\t// 将邀请码暂存到本地存储，以便登录页或其他页面使用\r\n\t\t\t\tuni.setStorageSync('pendingInviteCode', inviteCode);\r\n\t\t\t}\r\n\t\t},\r\n\t\tonShow: function() {\r\n\t\t\tconsole.log('App Show');\r\n\t\t\t// 在应用显示时，尝试启动定时器\r\n\t\t\tthis.startLocationUpdates();\r\n\t\t},\r\n\t\tonHide: function() {\r\n\t\t\tconsole.log('App Hide');\r\n\t\t\t// 应用隐藏时，停止定时器\r\n\t\t\tthis.stopLocationUpdates();\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t/**\r\n\t\t\t * 检查用户是否已登录\r\n\t\t\t */\r\n\t\t\tisLoggedIn() {\r\n\t\t\t\t// 这里假设你将登录凭证（例如 token 或 userId）保存在本地缓存中\r\n\t\t\t\t// 请根据你项目实际存储凭证的方式来修改\r\n\t\t\t\tconst token = uni.getStorageSync('token');\r\n\t\t\t\t// 如果 token 存在，则认为已登录\r\n\t\t\t\treturn !!token;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * 启动周期性位置上传\r\n\t\t\t */\r\n\t\t\tstartLocationUpdates() {\r\n\t\t\t\t// 先清除已有的定时器，防止重复启动\r\n\t\t\t\tthis.stopLocationUpdates();\r\n\r\n\t\t\t\t// 【核心修正】: 如果未登录，直接返回，不启动定时器\r\n\t\t\t\tif (!this.isLoggedIn()) {\r\n\t\t\t\t\tconsole.log('用户未登录，不启动位置上传定时器');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst updateTask = () => {\r\n\t\t\t\t\tconsole.log('正在获取并上传用户当前位置...');\r\n\t\t\t\t\tuni.getLocation({\r\n\t\t\t\t\t\ttype: 'gcj02',\r\n\t\t\t\t\t\tsuccess: async (res) => {\r\n\t\t\t\t\t\t\tconsole.log(`获取位置成功: ${res.longitude}, ${res.latitude}`);\r\n\r\n\t\t\t\t\t\t\t// 直接使用 request 调用接口\r\n\t\t\t\t\t\t\tconst {\r\n\t\t\t\t\t\t\t\terror\r\n\t\t\t\t\t\t\t} = await request('/app-api/member/user/upload-location', {\r\n\t\t\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\tlongitude: res.longitude,\r\n\t\t\t\t\t\t\t\t\tlatitude: res.latitude\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tif (error) {\r\n\t\t\t\t\t\t\t\tconsole.error('自动上传位置信息失败:', error);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tconsole.log('用户当前位置上传成功！');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\tconsole.error('获取位置信息失败:', err);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// 立即执行一次\r\n\t\t\t\tupdateTask();\r\n\r\n\t\t\t\t// 设置定时器，每10分钟 (600000毫秒) 执行一次\r\n\t\t\t\tthis.locationTimer = setInterval(updateTask, 600000);\r\n\t\t\t\tconsole.log('位置上传定时器已启动');\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * 停止位置上传\r\n\t\t\t */\r\n\t\t\tstopLocationUpdates() {\r\n\t\t\t\tif (this.locationTimer) {\r\n\t\t\t\t\tclearInterval(this.locationTimer);\r\n\t\t\t\t\tthis.locationTimer = null;\r\n\t\t\t\t\tconsole.log('位置上传定时器已停止');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n\r\n<style lang=\"scss\">\r\n\t/*每个页面公共css */\r\n\t@import '@/uni_modules/uni-scss/index.scss';\r\n\t/* #ifndef APP-NVUE */\r\n\t@import '@/static/customicons.css';\r\n\r\n\t// 设置整个项目的背景色\r\n\tpage {\r\n\t\tbackground-color: #f5f5f5;\r\n\t}\r\n\r\n\t/* #endif */\r\n\t.example-info {\r\n\t\tfont-size: 14px;\r\n\t\tcolor: #333;\r\n\t\tpadding: 10px;\r\n\t}\r\n</style>"],"names":["uni","request"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGC,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,eAAe;AAAA,IAChB;AAAA,EACA;AAAA,EACD,UAAU,SAAS,SAAS;AAC3BA,kBAAAA,MAAA,MAAA,QAAA,iBAAa,uDAAuD;AACpEA,kBAAAA,MAAA,MAAA,OAAA,iBAAY,YAAY;AAExB,QAAI,WAAW,QAAQ,SAAS,QAAQ,MAAM,YAAY;AACzD,YAAM,aAAa,QAAQ,MAAM;AACjCA,oBAAA,MAAA,MAAA,OAAA,iBAAY,+BAA+B,UAAU;AAGrDA,oBAAAA,MAAI,eAAe,qBAAqB,UAAU;AAAA,IACnD;AAAA,EACA;AAAA,EACD,QAAQ,WAAW;AAClBA,kBAAAA,MAAY,MAAA,OAAA,iBAAA,UAAU;AAEtB,SAAK,qBAAoB;AAAA,EACzB;AAAA,EACD,QAAQ,WAAW;AAClBA,kBAAAA,MAAY,MAAA,OAAA,iBAAA,UAAU;AAEtB,SAAK,oBAAmB;AAAA,EACxB;AAAA,EACD,SAAS;AAAA;AAAA;AAAA;AAAA,IAIR,aAAa;AAGZ,YAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AAExC,aAAO,CAAC,CAAC;AAAA,IACT;AAAA;AAAA;AAAA;AAAA,IAKD,uBAAuB;AAEtB,WAAK,oBAAmB;AAGxB,UAAI,CAAC,KAAK,cAAc;AACvBA,sBAAAA,MAAA,MAAA,OAAA,iBAAY,kBAAkB;AAC9B;AAAA,MACD;AAEA,YAAM,aAAa,MAAM;AACxBA,sBAAAA,MAAA,MAAA,OAAA,iBAAY,kBAAkB;AAC9BA,sBAAAA,MAAI,YAAY;AAAA,UACf,MAAM;AAAA,UACN,SAAS,OAAO,QAAQ;AACvBA,0BAAAA,MAAY,MAAA,OAAA,iBAAA,WAAW,IAAI,SAAS,KAAK,IAAI,QAAQ,EAAE;AAGvD,kBAAM;AAAA,cACL;AAAA,gBACG,MAAMC,cAAO,QAAC,wCAAwC;AAAA,cACzD,QAAQ;AAAA,cACR,MAAM;AAAA,gBACL,WAAW,IAAI;AAAA,gBACf,UAAU,IAAI;AAAA,cACf;AAAA,YACD,CAAC;AAED,gBAAI,OAAO;AACVD,4BAAA,MAAA,MAAA,SAAA,iBAAc,eAAe,KAAK;AAAA,mBAC5B;AACNA,4BAAAA,MAAY,MAAA,OAAA,iBAAA,aAAa;AAAA,YAC1B;AAAA,UACA;AAAA,UACD,MAAM,CAAC,QAAQ;AACdA,0BAAc,MAAA,MAAA,SAAA,iBAAA,aAAa,GAAG;AAAA,UAC/B;AAAA,QACD,CAAC;AAAA;AAIF;AAGA,WAAK,gBAAgB,YAAY,YAAY,GAAM;AACnDA,oBAAAA,oCAAY,YAAY;AAAA,IACxB;AAAA;AAAA;AAAA;AAAA,IAKD,sBAAsB;AACrB,UAAI,KAAK,eAAe;AACvB,sBAAc,KAAK,aAAa;AAChC,aAAK,gBAAgB;AACrBA,sBAAAA,MAAY,MAAA,OAAA,kBAAA,YAAY;AAAA,MACzB;AAAA,IACD;AAAA,EACD;AACD;;;;;;;;;"}