{"version":3,"names":["_sfc_main","data","locationTimer","onLaunch","options","common_vendor","index","__f__","finalQuery","query","scene","sceneStr","decodeURIComponent","sceneParams","split","forEach","item","parts","_objectSpread2","inviteCode","c","setStorageSync","onShow","startLocationUpdates","checkUpdate","onHide","stopLocationUpdates","methods","isLoggedIn","token","getStorageSync","updateTask","getLocation","type","success","_success","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","res","_yield$utils_request$","error","wrap","_callee$","_context","prev","next","concat","longitude","latitude","utils_request","request","method","sent","stop","_x","apply","arguments","fail","err","setInterval","clearInterval"],"sources":["App.vue"],"sourcesContent":["<script>\r\n\timport request from '@/utils/request.js';\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tlocationTimer: null\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLaunch: function(options) {\r\n\t\t\tconsole.warn('当前组件仅支持 uni_modules 目录结构 ，请升级 HBuilderX 到 3.1.0 版本以上！')\r\n\t\t\tconsole.log('App Launch')\r\n\r\n\t\t\tconsole.log('App Launch, 启动参数 options:', options);\r\n\r\n\t\t\tlet finalQuery = options.query || {};\r\n\r\n\t\t\t// 1. 检查是否存在 scene 参数 (扫码进入)\r\n\t\t\tif (options.scene) {\r\n\t\t\t\tconst sceneStr = decodeURIComponent(options.scene);\r\n\t\t\t\tconsole.log('✅ [App.vue] 检测到 scene 参数:', sceneStr);\r\n\t\t\t\t// 2. 将 scene 字符串解析成键值对对象\r\n\t\t\t\tconst sceneParams = {};\r\n\t\t\t\tsceneStr.split('&').forEach(item => {\r\n\t\t\t\t\tconst parts = item.split('=');\r\n\t\t\t\t\tif (parts[0] && parts[1]) {\r\n\t\t\t\t\t\tsceneParams[parts[0]] = parts[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tconsole.log('✅ [App.vue] scene 解析结果:', sceneParams);\r\n\t\t\t\t// 3. 将解析后的参数合并到 finalQuery 中，优先使用 scene 里的参数\r\n\t\t\t\tfinalQuery = {\r\n\t\t\t\t\t...finalQuery,\r\n\t\t\t\t\t...sceneParams\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// 4. 从最终的参数对象中提取邀请码\r\n\t\t\tconst inviteCode = finalQuery.c || finalQuery.inviteCode;\r\n\t\t\tif (inviteCode) {\r\n\t\t\t\tconsole.log('✅ [App.vue] 全局捕获到邀请码:', inviteCode);\r\n\t\t\t\tuni.setStorageSync('pendingInviteCode', inviteCode);\r\n\t\t\t}\r\n\t\t},\r\n\t\tonShow: function() {\r\n\t\t\tconsole.log('App Show');\r\n\t\t\t// 在应用显示时，尝试启动定时器\r\n\t\t\tthis.startLocationUpdates();\r\n\t\t\t// 检查并应用新版本\r\n\t\t\tthis.checkUpdate();\r\n\t\t},\r\n\t\tonHide: function() {\r\n\t\t\tconsole.log('App Hide');\r\n\t\t\t// 应用隐藏时，停止定时器\r\n\t\t\tthis.stopLocationUpdates();\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t/**\r\n\t\t\t * 检查用户是否已登录\r\n\t\t\t */\r\n\t\t\tisLoggedIn() {\r\n\t\t\t\t// 这里假设你将登录凭证（例如 token 或 userId）保存在本地缓存中\r\n\t\t\t\t// 请根据你项目实际存储凭证的方式来修改\r\n\t\t\t\tconst token = uni.getStorageSync('token');\r\n\t\t\t\t// 如果 token 存在，则认为已登录\r\n\t\t\t\treturn !!token;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * 启动周期性位置上传\r\n\t\t\t */\r\n\t\t\tstartLocationUpdates() {\r\n\t\t\t\t// 先清除已有的定时器，防止重复启动\r\n\t\t\t\tthis.stopLocationUpdates();\r\n\r\n\t\t\t\t// 【核心修正】: 如果未登录，直接返回，不启动定时器\r\n\t\t\t\tif (!this.isLoggedIn()) {\r\n\t\t\t\t\tconsole.log('用户未登录，不启动位置上传定时器');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst updateTask = () => {\r\n\t\t\t\t\tconsole.log('正在获取并上传用户当前位置...');\r\n\t\t\t\t\tuni.getLocation({\r\n\t\t\t\t\t\ttype: 'gcj02',\r\n\t\t\t\t\t\tsuccess: async (res) => {\r\n\t\t\t\t\t\t\tconsole.log(`获取位置成功: ${res.longitude}, ${res.latitude}`);\r\n\r\n\t\t\t\t\t\t\t// 直接使用 request 调用接口\r\n\t\t\t\t\t\t\tconst {\r\n\t\t\t\t\t\t\t\terror\r\n\t\t\t\t\t\t\t} = await request('/app-api/member/user/upload-location', {\r\n\t\t\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\tlongitude: res.longitude,\r\n\t\t\t\t\t\t\t\t\tlatitude: res.latitude\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tif (error) {\r\n\t\t\t\t\t\t\t\tconsole.error('自动上传位置信息失败:', error);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tconsole.log('用户当前位置上传成功！');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\tconsole.error('获取位置信息失败:', err);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// 立即执行一次\r\n\t\t\t\tupdateTask();\r\n\r\n\t\t\t\t// 设置定时器，每10分钟 (600000毫秒) 执行一次\r\n\t\t\t\tthis.locationTimer = setInterval(updateTask, 600000);\r\n\t\t\t\tconsole.log('位置上传定时器已启动');\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * 停止位置上传\r\n\t\t\t */\r\n\t\t\tstopLocationUpdates() {\r\n\t\t\t\tif (this.locationTimer) {\r\n\t\t\t\t\tclearInterval(this.locationTimer);\r\n\t\t\t\t\tthis.locationTimer = null;\r\n\t\t\t\t\tconsole.log('位置上传定时器已停止');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n\r\n<style lang=\"scss\">\r\n\t/*每个页面公共css */\r\n\t@import '@/uni_modules/uni-scss/index.scss';\r\n\t/* #ifndef APP-NVUE */\r\n\t@import '@/static/customicons.css';\r\n\r\n\t// 设置整个项目的背景色\r\n\tpage {\r\n\t\tbackground-color: #f5f5f5;\r\n\t}\r\n\r\n\t/* #endif */\r\n\t.example-info {\r\n\t\tfont-size: 14px;\r\n\t\tcolor: #333;\r\n\t\tpadding: 10px;\r\n\t}\r\n</style>"],"mappings":"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","ignoreList":[]}