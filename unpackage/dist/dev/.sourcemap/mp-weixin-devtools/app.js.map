{"version":3,"names":["_sfc_main","data","locationTimer","onLaunch","common_vendor","index","__f__","options","query","inviteCode","setStorageSync","onShow","startLocationUpdates","onHide","stopLocationUpdates","methods","isLoggedIn","token","getStorageSync","updateTask","getLocation","type","success","_success","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","res","_yield$utils_request$","error","wrap","_callee$","_context","prev","next","concat","longitude","latitude","utils_request","request","method","sent","stop","_x","apply","arguments","fail","err","setInterval","clearInterval"],"sources":["App.vue"],"sourcesContent":["<script>\r\n\timport request from '@/utils/request.js';\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tlocationTimer: null\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLaunch: function() {\r\n\t\t\tconsole.warn('当前组件仅支持 uni_modules 目录结构 ，请升级 HBuilderX 到 3.1.0 版本以上！')\r\n\t\t\tconsole.log('App Launch')\r\n\r\n\t\t\tif (options && options.query && options.query.inviteCode) {\r\n\t\t\t\tconst inviteCode = options.query.inviteCode;\r\n\t\t\t\tconsole.log('✅ [App.vue] 全局捕获到启动参数中的邀请码:', inviteCode);\r\n\r\n\t\t\t\t// 将邀请码暂存到本地存储，以便登录页或其他页面使用\r\n\t\t\t\tuni.setStorageSync('pendingInviteCode', inviteCode);\r\n\t\t\t}\r\n\t\t},\r\n\t\tonShow: function() {\r\n\t\t\tconsole.log('App Show');\r\n\t\t\t// 在应用显示时，尝试启动定时器\r\n\t\t\tthis.startLocationUpdates();\r\n\t\t},\r\n\t\tonHide: function() {\r\n\t\t\tconsole.log('App Hide');\r\n\t\t\t// 应用隐藏时，停止定时器\r\n\t\t\tthis.stopLocationUpdates();\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t/**\r\n\t\t\t * 检查用户是否已登录\r\n\t\t\t */\r\n\t\t\tisLoggedIn() {\r\n\t\t\t\t// 这里假设你将登录凭证（例如 token 或 userId）保存在本地缓存中\r\n\t\t\t\t// 请根据你项目实际存储凭证的方式来修改\r\n\t\t\t\tconst token = uni.getStorageSync('token');\r\n\t\t\t\t// 如果 token 存在，则认为已登录\r\n\t\t\t\treturn !!token;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * 启动周期性位置上传\r\n\t\t\t */\r\n\t\t\tstartLocationUpdates() {\r\n\t\t\t\t// 先清除已有的定时器，防止重复启动\r\n\t\t\t\tthis.stopLocationUpdates();\r\n\r\n\t\t\t\t// 【核心修正】: 如果未登录，直接返回，不启动定时器\r\n\t\t\t\tif (!this.isLoggedIn()) {\r\n\t\t\t\t\tconsole.log('用户未登录，不启动位置上传定时器');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst updateTask = () => {\r\n\t\t\t\t\tconsole.log('正在获取并上传用户当前位置...');\r\n\t\t\t\t\tuni.getLocation({\r\n\t\t\t\t\t\ttype: 'gcj02',\r\n\t\t\t\t\t\tsuccess: async (res) => {\r\n\t\t\t\t\t\t\tconsole.log(`获取位置成功: ${res.longitude}, ${res.latitude}`);\r\n\r\n\t\t\t\t\t\t\t// 直接使用 request 调用接口\r\n\t\t\t\t\t\t\tconst {\r\n\t\t\t\t\t\t\t\terror\r\n\t\t\t\t\t\t\t} = await request('/app-api/member/user/upload-location', {\r\n\t\t\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\tlongitude: res.longitude,\r\n\t\t\t\t\t\t\t\t\tlatitude: res.latitude\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tif (error) {\r\n\t\t\t\t\t\t\t\tconsole.error('自动上传位置信息失败:', error);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tconsole.log('用户当前位置上传成功！');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\tconsole.error('获取位置信息失败:', err);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// 立即执行一次\r\n\t\t\t\tupdateTask();\r\n\r\n\t\t\t\t// 设置定时器，每10分钟 (600000毫秒) 执行一次\r\n\t\t\t\tthis.locationTimer = setInterval(updateTask, 600000);\r\n\t\t\t\tconsole.log('位置上传定时器已启动');\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * 停止位置上传\r\n\t\t\t */\r\n\t\t\tstopLocationUpdates() {\r\n\t\t\t\tif (this.locationTimer) {\r\n\t\t\t\t\tclearInterval(this.locationTimer);\r\n\t\t\t\t\tthis.locationTimer = null;\r\n\t\t\t\t\tconsole.log('位置上传定时器已停止');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n\r\n<style lang=\"scss\">\r\n\t/*每个页面公共css */\r\n\t@import '@/uni_modules/uni-scss/index.scss';\r\n\t/* #ifndef APP-NVUE */\r\n\t@import '@/static/customicons.css';\r\n\r\n\t// 设置整个项目的背景色\r\n\tpage {\r\n\t\tbackground-color: #f5f5f5;\r\n\t}\r\n\r\n\t/* #endif */\r\n\t.example-info {\r\n\t\tfont-size: 14px;\r\n\t\tcolor: #333;\r\n\t\tpadding: 10px;\r\n\t}\r\n</style>"],"mappings":"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","ignoreList":[]}